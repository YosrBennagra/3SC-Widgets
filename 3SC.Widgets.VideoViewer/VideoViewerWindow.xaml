<Window x:Class="_3SC.Widgets.VideoViewer.VideoViewerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:_3SC.Widgets.VideoViewer"
        Title="Video Viewer"
        Width="750"
        Height="480"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Loaded="OnLoaded">

    <Window.Resources>
        <!-- Color Brushes -->
        <SolidColorBrush x:Key="WidgetSurface" Color="#D0080810"/>
        <SolidColorBrush x:Key="TextPrimary" Color="#FFF1F5F9"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#FFC7D2FE"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#FF818CF8"/>
        <SolidColorBrush x:Key="CardBackground" Color="#FF101018"/>
        <SolidColorBrush x:Key="CardBorder" Color="#FF1E1B4B"/>
        <SolidColorBrush x:Key="WidgetBackground" Color="#FF1E1B4B"/>
        <SolidColorBrush x:Key="WidgetOutline" Color="#FF2DD4BF"/>
        <SolidColorBrush x:Key="Accent" Color="#FF2DD4BF"/>

        <!-- Converters -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:InvertedBooleanToVisibilityConverter x:Key="InvertedBooleanToVisibilityConverter"/>

        <!-- Slider Thumb Template -->
        <ControlTemplate x:Key="SliderThumbTemplate" TargetType="Thumb">
            <Ellipse Width="12"
                     Height="12"
                     Fill="White"
                     Stroke="{StaticResource Accent}"
                     StrokeThickness="2"/>
        </ControlTemplate>

        <!-- Video Slider Style -->
        <Style x:Key="VideoSlider" TargetType="Slider">
            <Setter Property="Height" Value="4"/>
            <Setter Property="Background" Value="#40FFFFFF"/>
            <Setter Property="Foreground" Value="{StaticResource Accent}"/>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource WidgetSurface}"
            CornerRadius="12"
            BorderBrush="{StaticResource WidgetOutline}"
            BorderThickness="1">
        <Grid MinWidth="550"
              MinHeight="380">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="170"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: File List -->
            <Border Grid.Column="0"
                    Background="{StaticResource CardBackground}"
                    BorderBrush="{StaticResource CardBorder}"
                    BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Header -->
                    <Border Grid.Row="0"
                            Padding="10,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="Videos"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimary}"
                                       VerticalAlignment="Center"/>

                            <Button Grid.Column="1"
                                    Command="{Binding RefreshCommand}"
                                    ToolTip="Refresh"
                                    Cursor="Hand"
                                    Opacity="0.7">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg"
                                                Padding="4"
                                                CornerRadius="4"
                                                Background="Transparent">
                                            <TextBlock Text="&#xE72C;"
                                                       FontFamily="Segoe MDL2 Assets"
                                                       FontSize="12"
                                                       Foreground="{StaticResource TextSecondary}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="bg"
                                                        Property="Background"
                                                        Value="{StaticResource CardBackground}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Search box -->
                    <Border Grid.Row="1"
                            Margin="8,0,8,8"
                            Padding="8,6"
                            CornerRadius="6"
                            Background="{StaticResource WidgetBackground}"
                            BorderBrush="{StaticResource CardBorder}"
                            BorderThickness="1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="&#xE721;"
                                       FontFamily="Segoe MDL2 Assets"
                                       FontSize="12"
                                       Foreground="{StaticResource TextTertiary}"
                                       VerticalAlignment="Center"
                                       Margin="0,0,6,0"/>

                            <TextBox Grid.Column="1"
                                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                     FontSize="12"
                                     Foreground="{StaticResource TextPrimary}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     VerticalAlignment="Center"
                                     CaretBrush="{StaticResource Accent}"/>

                            <TextBlock Grid.Column="1"
                                       Text="Search..."
                                       FontSize="12"
                                       Foreground="{StaticResource TextTertiary}"
                                       VerticalAlignment="Center"
                                       IsHitTestVisible="False">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility"
                                                Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SearchText}"
                                                         Value="">
                                                <Setter Property="Visibility"
                                                        Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </Border>

                    <!-- File list -->
                    <ScrollViewer Grid.Row="2"
                                  VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <StackPanel>
                            <!-- Loading indicator -->
                            <StackPanel Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        HorizontalAlignment="Center"
                                        Margin="0,20">
                                <TextBlock Text="&#xE117;"
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="16"
                                           Foreground="{StaticResource TextTertiary}"
                                           HorizontalAlignment="Center">
                                    <TextBlock.RenderTransform>
                                        <RotateTransform CenterX="8"
                                                         CenterY="8"/>
                                    </TextBlock.RenderTransform>
                                    <TextBlock.Triggers>
                                        <EventTrigger RoutedEvent="Loaded">
                                            <BeginStoryboard>
                                                <Storyboard RepeatBehavior="Forever">
                                                    <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                     From="0"
                                                                     To="360"
                                                                     Duration="0:0:1"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </TextBlock.Triggers>
                                </TextBlock>
                                <TextBlock Text="Scanning..."
                                           FontSize="11"
                                           Foreground="{StaticResource TextTertiary}"
                                           HorizontalAlignment="Center"
                                           Margin="0,4,0,0"/>
                            </StackPanel>

                            <!-- Recent files section -->
                            <StackPanel Visibility="{Binding HasRecentFiles, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Margin="8,4,8,0">
                                <TextBlock Text="RECENT"
                                           FontSize="10"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextTertiary}"
                                           Margin="4,0,0,4"/>

                                <ItemsControl ItemsSource="{Binding RecentFiles}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Command="{Binding DataContext.SelectFileCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand"
                                                    Margin="0,1">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="bg"
                                                                Padding="6,5"
                                                                CornerRadius="4"
                                                                Background="Transparent">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Border Width="28"
                                                                        Height="28"
                                                                        CornerRadius="4"
                                                                        Background="#20E74C3C"
                                                                        Margin="0,0,8,0">
                                                                    <TextBlock Text="&#xE714;"
                                                                               FontFamily="Segoe MDL2 Assets"
                                                                               FontSize="12"
                                                                               Foreground="#E74C3C"
                                                                               HorizontalAlignment="Center"
                                                                               VerticalAlignment="Center"/>
                                                                </Border>

                                                                <StackPanel Grid.Column="1"
                                                                            VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding FileName}"
                                                                               FontSize="11"
                                                                               Foreground="{StaticResource TextPrimary}"
                                                                               TextTrimming="CharacterEllipsis"
                                                                               MaxWidth="110"/>
                                                                    <TextBlock Text="{Binding FileSize}"
                                                                               FontSize="9"
                                                                               Foreground="{StaticResource TextTertiary}"/>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter TargetName="bg"
                                                                        Property="Background"
                                                                        Value="{StaticResource WidgetBackground}"/>
                                                            </Trigger>
                                                            <DataTrigger Binding="{Binding IsSelected}"
                                                                         Value="True">
                                                                <Setter TargetName="bg"
                                                                        Property="Background"
                                                                        Value="{StaticResource Accent}"/>
                                                            </DataTrigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <!-- Divider between recent and discovered -->
                            <Border Height="1"
                                    Margin="12,8"
                                    Background="{StaticResource CardBorder}"
                                    Opacity="0.3"
                                    Visibility="{Binding HasRecentFiles, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                            <!-- Discovered files section -->
                            <StackPanel Margin="8,0,8,8">
                                <TextBlock Text="FROM VIDEOS &amp; DOWNLOADS"
                                           FontSize="10"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextTertiary}"
                                           Margin="4,0,0,4"
                                           Visibility="{Binding HasVideoFiles, Converter={StaticResource BooleanToVisibilityConverter}}"/>

                                <ItemsControl ItemsSource="{Binding VideoFiles}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Command="{Binding DataContext.SelectFileCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand"
                                                    Margin="0,1">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border x:Name="bg"
                                                                Padding="6,5"
                                                                CornerRadius="4"
                                                                Background="Transparent">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Border Width="28"
                                                                        Height="28"
                                                                        CornerRadius="4"
                                                                        Background="#20E74C3C"
                                                                        Margin="0,0,8,0">
                                                                    <TextBlock Text="&#xE714;"
                                                                               FontFamily="Segoe MDL2 Assets"
                                                                               FontSize="12"
                                                                               Foreground="#E74C3C"
                                                                               HorizontalAlignment="Center"
                                                                               VerticalAlignment="Center"/>
                                                                </Border>

                                                                <StackPanel Grid.Column="1"
                                                                            VerticalAlignment="Center">
                                                                    <TextBlock Text="{Binding FileName}"
                                                                               FontSize="11"
                                                                               Foreground="{StaticResource TextPrimary}"
                                                                               TextTrimming="CharacterEllipsis"
                                                                               MaxWidth="110"/>
                                                                    <StackPanel Orientation="Horizontal">
                                                                        <TextBlock Text="{Binding FileSize}"
                                                                                   FontSize="9"
                                                                                   Foreground="{StaticResource TextTertiary}"/>
                                                                        <TextBlock Text=" â€¢ "
                                                                                   FontSize="9"
                                                                                   Foreground="{StaticResource TextTertiary}"/>
                                                                        <TextBlock Text="{Binding LastModifiedText}"
                                                                                   FontSize="9"
                                                                                   Foreground="{StaticResource TextTertiary}"/>
                                                                    </StackPanel>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver"
                                                                     Value="True">
                                                                <Setter TargetName="bg"
                                                                        Property="Background"
                                                                        Value="{StaticResource WidgetBackground}"/>
                                                            </Trigger>
                                                            <DataTrigger Binding="{Binding IsSelected}"
                                                                         Value="True">
                                                                <Setter TargetName="bg"
                                                                        Property="Background"
                                                                        Value="{StaticResource Accent}"/>
                                                            </DataTrigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- No files found -->
                                <TextBlock Text="No videos found"
                                           FontSize="11"
                                           Foreground="{StaticResource TextTertiary}"
                                           HorizontalAlignment="Center"
                                           Margin="0,12"
                                           Visibility="{Binding HasVideoFiles, Converter={StaticResource InvertedBooleanToVisibilityConverter}}"/>
                            </StackPanel>

                            <!-- Browse button -->
                            <Button Command="{Binding BrowseVideoCommand}"
                                    Margin="8,4,8,12"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg"
                                                Padding="10,8"
                                                CornerRadius="6"
                                                Background="{StaticResource WidgetBackground}"
                                                BorderBrush="{StaticResource CardBorder}"
                                                BorderThickness="1">
                                            <StackPanel Orientation="Horizontal"
                                                        HorizontalAlignment="Center">
                                                <TextBlock Text="&#xE8E5;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="12"
                                                           Foreground="{StaticResource TextSecondary}"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,6,0"/>
                                                <TextBlock Text="Browse"
                                                           FontSize="11"
                                                           FontWeight="Medium"
                                                           Foreground="{StaticResource TextSecondary}"/>
                                            </StackPanel>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="bg"
                                                        Property="Background"
                                                        Value="{StaticResource Accent}"/>
                                                <Setter TargetName="bg"
                                                        Property="BorderBrush"
                                                        Value="{StaticResource Accent}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Right Panel: Video Preview -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header with file info and actions -->
                <Border Grid.Row="0"
                        Padding="12,8"
                        Background="Transparent"
                        MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- File info -->
                        <StackPanel Grid.Column="0"
                                    VerticalAlignment="Center"
                                    Visibility="{Binding HasVideo, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <TextBlock Text="{Binding FileName}"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimary}"
                                       TextTrimming="CharacterEllipsis"/>
                            <TextBlock Text="{Binding FileInfo}"
                                       FontSize="11"
                                       Foreground="{StaticResource TextTertiary}"/>
                        </StackPanel>

                        <!-- Empty state header -->
                        <TextBlock Grid.Column="0"
                                   Text="Video Preview"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimary}"
                                   VerticalAlignment="Center"
                                   Visibility="{Binding HasVideo, Converter={StaticResource InvertedBooleanToVisibilityConverter}}"/>

                        <!-- Action buttons -->
                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    Visibility="{Binding HasVideo, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <!-- Open in default app -->
                            <Button Command="{Binding OpenInDefaultAppCommand}"
                                    ToolTip="Open in default player"
                                    Cursor="Hand"
                                    Margin="0,0,4,0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg"
                                                Padding="6,4"
                                                CornerRadius="4"
                                                Background="Transparent">
                                            <TextBlock Text="&#xE7AC;"
                                                       FontFamily="Segoe MDL2 Assets"
                                                       FontSize="13"
                                                       Foreground="{StaticResource TextSecondary}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="bg"
                                                        Property="Background"
                                                        Value="{StaticResource CardBackground}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <!-- Show in Explorer -->
                            <Button Command="{Binding OpenInExplorerCommand}"
                                    ToolTip="Show in Explorer"
                                    Cursor="Hand"
                                    Margin="0,0,4,0">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg"
                                                Padding="6,4"
                                                CornerRadius="4"
                                                Background="Transparent">
                                            <TextBlock Text="&#xED25;"
                                                       FontFamily="Segoe MDL2 Assets"
                                                       FontSize="13"
                                                       Foreground="{StaticResource TextSecondary}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="bg"
                                                        Property="Background"
                                                        Value="{StaticResource CardBackground}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>

                            <!-- Clear -->
                            <Button Command="{Binding ClearVideoCommand}"
                                    ToolTip="Clear video"
                                    Cursor="Hand">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="bg"
                                                Padding="6,4"
                                                CornerRadius="4"
                                                Background="Transparent">
                                            <TextBlock Text="&#xE711;"
                                                       FontFamily="Segoe MDL2 Assets"
                                                       FontSize="13"
                                                       Foreground="{StaticResource TextSecondary}"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="bg"
                                                        Property="Background"
                                                        Value="{StaticResource CardBackground}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Divider -->
                <Border Grid.Row="0"
                        VerticalAlignment="Bottom"
                        Height="1"
                        Background="{StaticResource CardBorder}"
                        Opacity="0.25"/>

                <!-- Video Area -->
                <Grid Grid.Row="1"
                      Margin="8">
                    <!-- Empty state / Drop zone -->
                    <Border CornerRadius="8"
                            BorderThickness="2"
                            BorderBrush="{StaticResource CardBorder}"
                            Background="Transparent"
                            AllowDrop="True"
                            Drop="Border_Drop"
                            DragOver="Border_DragOver"
                            Visibility="{Binding HasVideo, Converter={StaticResource InvertedBooleanToVisibilityConverter}}">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="BorderBrush"
                                        Value="{StaticResource CardBorder}"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver"
                                             Value="True">
                                        <Setter Property="BorderBrush"
                                                Value="{StaticResource Accent}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <StackPanel HorizontalAlignment="Center"
                                    VerticalAlignment="Center">
                            <Border Width="72"
                                    Height="72"
                                    CornerRadius="36"
                                    Background="{StaticResource CardBackground}"
                                    HorizontalAlignment="Center"
                                    Margin="0,0,0,16">
                                <TextBlock Text="&#xE714;"
                                           FontFamily="Segoe MDL2 Assets"
                                           FontSize="28"
                                           Foreground="{StaticResource TextTertiary}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Drop a video here"
                                       FontSize="14"
                                       FontWeight="Medium"
                                       Foreground="{StaticResource TextPrimary}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="or select from the list"
                                       FontSize="12"
                                       Foreground="{StaticResource TextTertiary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,4,0,0"/>
                            <TextBlock Text="MP4, AVI, MKV, MOV, WMV, WEBM"
                                       FontSize="10"
                                       Foreground="{StaticResource TextTertiary}"
                                       HorizontalAlignment="Center"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Video player -->
                    <Border CornerRadius="8"
                            ClipToBounds="True"
                            Background="#FF000000"
                            Visibility="{Binding HasVideo, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Grid>
                            <MediaElement x:Name="VideoPlayer"
                                          Source="{Binding VideoSource}"
                                          LoadedBehavior="Manual"
                                          UnloadedBehavior="Stop"
                                          Volume="{Binding Volume}"
                                          IsMuted="{Binding IsMuted}"
                                          Stretch="Uniform"
                                          MediaOpened="VideoPlayer_MediaOpened"
                                          MediaEnded="VideoPlayer_MediaEnded"/>

                            <!-- Loading overlay -->
                            <Border Background="#80000000"
                                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel HorizontalAlignment="Center"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="&#xE117;"
                                               FontFamily="Segoe MDL2 Assets"
                                               FontSize="24"
                                               Foreground="White"
                                               HorizontalAlignment="Center">
                                        <TextBlock.RenderTransform>
                                            <RotateTransform CenterX="12"
                                                             CenterY="12"/>
                                        </TextBlock.RenderTransform>
                                        <TextBlock.Triggers>
                                            <EventTrigger RoutedEvent="Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard RepeatBehavior="Forever">
                                                        <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                                                                         From="0"
                                                                         To="360"
                                                                         Duration="0:0:1"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </TextBlock.Triggers>
                                    </TextBlock>
                                    <TextBlock Text="Loading..."
                                               FontSize="12"
                                               Foreground="White"
                                               HorizontalAlignment="Center"
                                               Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Play overlay (when paused) -->
                            <Button Command="{Binding PlayPauseCommand}"
                                    Cursor="Hand"
                                    Visibility="{Binding IsPlaying, Converter={StaticResource InvertedBooleanToVisibilityConverter}}">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="Transparent">
                                            <Border x:Name="playBtn"
                                                    Width="56"
                                                    Height="56"
                                                    CornerRadius="28"
                                                    Background="#CC000000"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="&#xE768;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="24"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           Margin="4,0,0,0"/>
                                            </Border>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver"
                                                     Value="True">
                                                <Setter TargetName="playBtn"
                                                        Property="Background"
                                                        Value="{StaticResource Accent}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>
                </Grid>

                <!-- Controls footer -->
                <Border Grid.Row="2"
                        Padding="12,12,12,14"
                        Background="{StaticResource CardBackground}"
                        Visibility="{Binding HasVideo, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="8"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Progress bar row -->
                        <Grid Grid.Row="0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="ProgressSlider"
                                    Value="{Binding Progress, Mode=TwoWay}"
                                    Minimum="0"
                                    Maximum="100"
                                    Style="{StaticResource VideoSlider}"
                                    Cursor="Hand"
                                    PreviewMouseLeftButtonDown="ProgressSlider_PreviewMouseLeftButtonDown"
                                    PreviewMouseLeftButtonUp="ProgressSlider_PreviewMouseLeftButtonUp"
                                    ValueChanged="ProgressSlider_ValueChanged"/>
                        </Grid>

                        <!-- Playback controls row -->
                        <Grid Grid.Row="2"
                              Height="36">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="70"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Left: Position text -->
                            <TextBlock Grid.Column="0"
                                       Text="{Binding PositionText}"
                                       FontSize="11"
                                       FontFamily="Segoe UI"
                                       Foreground="{StaticResource TextTertiary}"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"/>

                            <!-- Center: Playback buttons -->
                            <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">

                                <!-- Skip back 10s -->
                                <Button Command="{Binding SkipBackwardCommand}"
                                        ToolTip="-10 seconds"
                                        Cursor="Hand"
                                        Margin="0,0,8,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bg"
                                                    Width="28"
                                                    Height="28"
                                                    CornerRadius="14"
                                                    Background="Transparent">
                                                <TextBlock Text="&#xED3C;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="14"
                                                           Foreground="{StaticResource TextSecondary}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver"
                                                         Value="True">
                                                    <Setter TargetName="bg"
                                                            Property="Background"
                                                            Value="{StaticResource WidgetBackground}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <!-- Play/Pause -->
                                <Button Command="{Binding PlayPauseCommand}"
                                        ToolTip="{Binding PlayPauseTooltip}"
                                        Cursor="Hand">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bg"
                                                    Width="36"
                                                    Height="36"
                                                    CornerRadius="18"
                                                    Background="{StaticResource Accent}">
                                                <TextBlock Text="{Binding PlayPauseIcon}"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="16"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver"
                                                         Value="True">
                                                    <Setter TargetName="bg"
                                                            Property="Opacity"
                                                            Value="0.85"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <!-- Skip forward 10s -->
                                <Button Command="{Binding SkipForwardCommand}"
                                        ToolTip="+10 seconds"
                                        Cursor="Hand"
                                        Margin="8,0,0,0">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bg"
                                                    Width="28"
                                                    Height="28"
                                                    CornerRadius="14"
                                                    Background="Transparent">
                                                <TextBlock Text="&#xED3D;"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="14"
                                                           Foreground="{StaticResource TextSecondary}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver"
                                                         Value="True">
                                                    <Setter TargetName="bg"
                                                            Property="Background"
                                                            Value="{StaticResource WidgetBackground}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>
                            </StackPanel>

                            <!-- Right: Volume -->
                            <StackPanel Grid.Column="2"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center">

                                <!-- Mute button -->
                                <Button Command="{Binding ToggleMuteCommand}"
                                        ToolTip="Mute/Unmute"
                                        Cursor="Hand">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bg"
                                                    Width="28"
                                                    Height="28"
                                                    CornerRadius="14"
                                                    Background="Transparent">
                                                <TextBlock Text="{Binding VolumeIcon}"
                                                           FontFamily="Segoe MDL2 Assets"
                                                           FontSize="14"
                                                           Foreground="{StaticResource TextSecondary}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver"
                                                         Value="True">
                                                    <Setter TargetName="bg"
                                                            Property="Background"
                                                            Value="{StaticResource WidgetBackground}"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                </Button>

                                <!-- Volume slider -->
                                <Slider Value="{Binding Volume, Mode=TwoWay}"
                                        Minimum="0"
                                        Maximum="1"
                                        Width="60"
                                        Style="{StaticResource VideoSlider}"
                                        VerticalAlignment="Center"
                                        Cursor="Hand"
                                        Margin="4,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
