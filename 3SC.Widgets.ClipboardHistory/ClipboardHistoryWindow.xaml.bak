<local:WidgetWindowBase
    x:Class="_3SC.Widgets.ClipboardHistory.ClipboardHistoryWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:_3SC.Widgets.ClipboardHistory"
    Title="Clipboard History"
    Width="350"
    Height="450"
    WindowStyle="None"
    AllowsTransparency="True"
    Background="Transparent"
    ShowInTaskbar="False"
    ResizeMode="NoResize"
    Topmost="False">

    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <!-- Window Resources - 3SC Dark Theme                                        -->
    <!-- ═══════════════════════════════════════════════════════════════════════ -->
    <local:WidgetWindowBase.Resources>
        <!-- Background Colors -->
        <SolidColorBrush x:Key="WidgetBackground" Color="#FF0A0A0F"/>
        <SolidColorBrush x:Key="WidgetSurface" Color="#D0080810"/>
        <SolidColorBrush x:Key="SurfaceElevated" Color="#FF16161F"/>
        <SolidColorBrush x:Key="SurfaceHover" Color="#FF1C1C28"/>
        
        <!-- Text Colors -->
        <SolidColorBrush x:Key="TextPrimary" Color="#FFF1F5F9"/>
        <SolidColorBrush x:Key="TextSecondary" Color="#FF94A3B8"/>
        <SolidColorBrush x:Key="TextTertiary" Color="#FF64748B"/>
        
        <!-- Accent Colors -->
        <SolidColorBrush x:Key="Accent" Color="#FF2DD4BF"/>
        <SolidColorBrush x:Key="AccentHover" Color="#FF5EEAD4"/>
        <SolidColorBrush x:Key="AccentPressed" Color="#FF14B8A6"/>
        
        <!-- Border Colors -->
        <SolidColorBrush x:Key="Border" Color="#FF2A2A3A"/>
        <SolidColorBrush x:Key="BorderHover" Color="#FF3A3A4A"/>
        <SolidColorBrush x:Key="BorderSubtle" Color="#20FFFFFF"/>
        
        <!-- Card Colors -->
        <SolidColorBrush x:Key="CardBackground" Color="#FF101018"/>
        <SolidColorBrush x:Key="CardBorder" Color="#FF1E1B4B"/>
        
        <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        
        <!-- Fade-in animation -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                             From="0" To="1"
                             Duration="0:0:0.3">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Context Menu Style -->
        <Style TargetType="ContextMenu">
            <Setter Property="Background" Value="{StaticResource SurfaceElevated}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Border}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" BlurRadius="16" ShadowDepth="4" Opacity="0.4"/>
                            </Border.Effect>
                            <StackPanel IsItemsHost="True"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- MenuItem Style -->
        <Style TargetType="MenuItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="MenuItem">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ContentPresenter Grid.Column="0"
                                                  ContentSource="Icon"
                                                  Width="16" Height="16"
                                                  Margin="0,0,8,0"
                                                  VerticalAlignment="Center"/>
                                <ContentPresenter Grid.Column="1"
                                                  ContentSource="Header"
                                                  VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2"
                                           x:Name="Checkmark"
                                           Text="✓"
                                           Foreground="{StaticResource Accent}"
                                           Visibility="Collapsed"
                                           VerticalAlignment="Center"
                                           Margin="8,0,0,0"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{StaticResource SurfaceHover}"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Checkmark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Separator Style -->
        <Style TargetType="Separator">
            <Setter Property="Height" Value="1"/>
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="Background" Value="{StaticResource Border}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Separator">
                        <Border Background="{TemplateBinding Background}"
                                Height="{TemplateBinding Height}"/>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </local:WidgetWindowBase.Resources>

    <Grid Margin="6">
        <Border x:Name="RootBorder"
                Background="{StaticResource WidgetSurface}"
                CornerRadius="12"
                SnapsToDevicePixels="True">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border x:Name="HeaderBorder"
                        Grid.Row="0"
                        Background="Transparent"
                        Padding="12,8"
                        Cursor="SizeAll"
                        MouseLeftButtonDown="Header_MouseLeftButtonDown"
                        MouseMove="Header_MouseMove"
                        MouseLeftButtonUp="Header_MouseLeftButtonUp">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0"
                                   Text="Clipboard History"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimary}"
                                   VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="1"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center">
                            <TextBlock FontSize="10"
                                       Foreground="{StaticResource TextTertiary}">
                                <Run Text="{Binding ClipboardItems.Count, Mode=OneWay}"/>
                                <Run Text=" items"/>
                            </TextBlock>
                            <TextBlock Text=" • "
                                       FontSize="10"
                                       Margin="6,0"
                                       Foreground="{StaticResource TextTertiary}"/>
                            <TextBlock FontSize="10"
                                       Foreground="{StaticResource Accent}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text"
                                                Value="Active"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsMonitoring}"
                                                    Value="False">
                                                <Setter Property="Text"
                                                        Value="Paused"/>
                                                <Setter Property="Foreground"
                                                        Value="{StaticResource TextTertiary}"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Divider -->
                <Border Grid.Row="0"
                        VerticalAlignment="Bottom"
                        Height="1"
                        Margin="8,0"
                        Background="{StaticResource CardBorder}"
                        Opacity="0.25"/>

                <!-- Items -->
                <ScrollViewer Grid.Row="1"
                        Padding="12"
                        VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding ClipboardItems}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,8"
                                        Padding="8"
                                        Background="{StaticResource CardBackground}"
                                        BorderBrush="{StaticResource CardBorder}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Cursor="Hand"
                                        ToolTip="Click to copy">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Grid.Column="0"
                                                Text="{Binding DisplayText}"
                                                FontSize="12"
                                                Foreground="{StaticResource TextPrimary}"
                                                TextTrimming="CharacterEllipsis"
                                                VerticalAlignment="Center"/>

                                        <Button Grid.Column="1"
                                                Width="24"
                                                Height="24"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Cursor="Hand"
                                                Click="DeleteItem_Click"
                                                ToolTip="Remove">
                                            <TextBlock Text="&#xE74D;"
                                                    FontFamily="Segoe MDL2 Assets"
                                                    Foreground="{StaticResource TextTertiary}"
                                                    HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
